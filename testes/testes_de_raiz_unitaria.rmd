---
title: "Testes de raiz unitária"
output: pdf_document
---

```{r, include = F, echo = FALSE}
knitr::opts_chunk$set(comment = NA, warning = FALSE, message = FALSE)
```

```{r, echo = F}

suppressPackageStartupMessages(library(tidyverse))

series <- read_csv("~/Documentos/mono/dados/series_economicas_log.csv")

time_series <- series %>% select(-date) %>%
  ts(start = c(2011, 1), frequency = 12)

```

# Gráficos de todas as séries

Cada série conta com `r dim(series)[1]` observações, de periodicidade mensal.

```{r, echo = F, include = T, plot_de_todas_as_series}

time_series %>% plot.ts()

```

# Séries diagnosticadas como estacionárias em cada teste (Augmented Dickey-Fuller)

Foi usado o teste ADF com o número de lags, usado para o tratamento de possível autocorrelação serial, computado pelo critério de seleção de Akaike (com o BIC os resultados não parecem mudar significativamente).

```{r, echo = F, include = T, adf_lags_AIC}

library(urca)

#----------------------------------------------------------
# funções para extrair estatistica de teste e valor critico
# do objeto criado pela função ur.df do pacote urca
estatistica_teste <- function(DF, VARIAVEL, TIPO, CRITERIO) {
    DF %>% pull(VARIAVEL) %>%
      ur.df(type = TIPO, selectlags = CRITERIO) %>%
      summary %>% slot("teststat") %>% `[`(1)
  }

valor_critico <- function(DF, VARIAVEL, TIPO, CRITERIO) {
    DF %>% pull(VARIAVEL) %>%
      ur.df(type = TIPO, selectlags = CRITERIO) %>%
      summary %>% slot("cval") %>% `[`(1, "5pct")
  }

#----------------------------------------------------------
# manipulando os dados para obter um data.frame
# com os p-valores dos testes

series_sem_data <- series %>% select(-date) %>% names

resultados <-
  expand.grid(series_sem_data, c("none", "drift", "trend"), "AIC", stringsAsFactors = F) %>%
  rename("variavel" = Var1, "tipo" = Var2, "criterio" = Var3) %>%
  rowwise %>%
  mutate(
         estatistica_teste = estatistica_teste(series, variavel, tipo, criterio),
         valor_critico = valor_critico(series, variavel, tipo, criterio),
         diagnostico = ifelse(estatistica_teste < valor_critico,
                              "estacionário", "não-estacionário")
         ) %>%
  filter(diagnostico == "estacionário")

resultados %>%
  knitr::kable(digits = 2, align = "l")

resultados %>% write_csv("resultados_teste_raiz_unitaria.csv")

```
